---
title: "chickadees_EDA"
output: html_document
date: "2023-03-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/charleshanks/repos/chickadees')
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(skimr)
library(survival)
library(survminer)
library(fitdistrplus)
```


```{r}
lever = read_csv('LeverPullingPerformance.csv')
paper = read_csv('PaperRippingPerformance.csv')
pr = read_csv('Persistence&Repeatability.csv')
```


#GROUP PROJECT 2: CHICKADEES 

##Looking at Persistence and Reliability dataset: 

###Variables
capturedate: date (yyyymmdd) that each bird was captured
site: code of each field site.
indiv: individual band number identification
age: age class – adult or juvenile.
sex: female or male.
habitat: rural (urban score < 0) or urban (urban score > 0) habitat type.
urbanscore: urbanization score generated by PCA analysis used to infer degree of urbanization at each site.
explscore: exploration score generated by PCA analysis.
domscore: dominance score based on interactions between birds at RFID feeders.
lpsolve: whether the lever-pulling task was solved (Y) or not (N).
lplatency: latency to solve or become censored in the lever-pulling trials.
lpstatus: censoring status of latency to solve the lever-pulling task used for cox regression (0 = censored, 1 = uncensored).
lpcontacts: total number of contacts made with the lever-pulling task until the bird solved the task or the observation became censored.
prsolve: whether the paper-ripping task was solved (Y) or not (N).
prlatency: latency to solve or become censored in the paper-ripping trials.
prstatus: censoring status of latency to solve the paper-ripping task used for cox regression (0 = censored, 1 = uncensored).
prcontacts: total number of contacts made with the paper-ripping task until the bird solved the task or the observation became censored




##DATASET 1: Lever 

Variables: 

indiv: individual band number identification
latency: latency to solve or become censored in the lever-pulling trials
status: censoring status of latency to solve the lever-pulling task used for cox regression (0 = censored, 1 = uncensored)
tstart: start time (in seconds) of each time interval used for the extended cox regression
tstop: stop time (in seconds) of each time interval used for the extended cox regression
contacts: number of contacts made with the task in each time interval
domscore: dominance score based on interactions between birds at RFID feeders.
urbanscore: urbanization score generated by PCA analysis used to infer degree of urbanization at each site.
explscore: exploration score generated by PCA analysis.
solve: indicator of whether the task was solved in each time interval (0 = unsolved, 1 = solved)
site: code of each field site.
habitat: rural (urban score < 0) or urban (urban score > 0) habitat type.
age: age class – adult or juvenile.
sex: female or male.


```{r}
skim(lever)

lever %>% group_by(indiv) %>% count()

birds_solve = lever %>% filter(solve == 1) %>%  group_by(indiv) %>% summarize(time = max(tstop), status, status)
#38 of the 65 birds in dataset solved teh problem 

#all the birds start at 0 
lever %>% group_by(indiv) %>% summarize(min_time = min(tstart))

lever %>% group_by(indiv) %>% summarize(time = max(tstop), status, solve)


lever2 = lever %>% group_by(status, indiv, habitat,age) %>% summarize (time = max(tstop), contacts = sum(contacts), domscore = unique(domscore), urbanscore = unique(urbanscore), explscore = unique(explscore), solve = max(solve))
                                                 
# 27 birds did not solve the game 
lever2.km = survfit(Surv(lever2$time,lever2$status) ~ 1)

ggsurvplot(fit = lever2.km, data = lever2, risk.table = F, conf.int = T, fun = "event", surv.median.line = "hv") 


#making a survival curve stratified by binned domscore: 

lever2 = lever2 %>%  mutate(dom_bin = case_when(domscore <= .34 ~ "low", 
                                  (domscore > .34 & domscore <=.67) ~ "medium", 
                                  domscore > .67 ~ "high"))



lever2.km2 = survfit(Surv(lever2$time,lever2$status) ~ lever2$dom_bin)

ggsurvplot(fit = lever2.km2, data = lever2, risk.table = F, conf.int = F, fun = "event") + labs(title = "More dominant birds are better at solving problem")


#urban or rural: 
lever2.km3 = survfit(Surv(lever2$time,lever2$status) ~ lever2$habitat)
ggsurvplot(fit = lever2.km3, data = lever2, risk.table = F, conf.int = F, fun = "event") + labs(title = "Rural vs. Urban Birds")

#rural birds are better at solving at the beginning, but by the end they have the same likelihood of solving problem. 


#checking out age: 
lever2.km4 = survfit(Surv(lever2$time,lever2$status) ~ lever2$age)

ggsurvplot(fit = lever2.km4, data = lever2, risk.table = F, conf.int = F, fun = "event") + labs(title = "Juvenile vs. Adult Birds")

```

##DATASET 2: Paper 

indiv: individual band number identification.
latency: latency to solve or become censored in the paper-ripping trials.
status: censoring status of latency to solve the paper-ripping task used for cox regression (0 = censored, 1 = uncensored).
tstart: start time (in seconds) of each time interval used for the extended cox regression.
tstop: stop time (in seconds) of each time interval used for the extended cox regression.
contacts: number of contacts made with the task in each time interval.
domscore: dominance score based on interactions between birds at RFID feeders.
urbanscore: urbanization score generated by PCA analysis used to infer degree of urbanization at each site.
explscore: exploration score generated by PCA analysis.
solve: indicator of whether the task was solved in each time interval (0 = unsolved, 1 = solved).
site: code of each field site.
habitat: rural (urban score < 0) or urban (urban score > 0) habitat type.

```{r}
paper2 = paper %>% group_by(status, indiv, habitat) %>% summarize (time = max(tstop), contacts = sum(contacts), domscore = unique(domscore), urbanscore = unique(urbanscore), explscore = unique(explscore), solve = max(solve))

#general km curve all birds (no strata):
paper2.km = survfit(Surv(paper2$time,paper2$status) ~ 1)

ggsurvplot(fit = paper2.km, data = paper2, risk.table = F, conf.int = T, fun = "event", surv.median.line = "hv") 

```

Dominance characteristic did not have a huge affect on ability to solve problem: 
```{r}

paper2 = paper2 %>%  mutate(dom_bin = case_when(domscore <= .34 ~ "low", 
                                  (domscore > .34 & domscore <=.67) ~ "medium", 
                                  domscore > .67 ~ "high"))

paper2.km2 = survfit(Surv(paper2$time,paper2$status) ~ paper2$dom_bin)

ggsurvplot(fit = paper2.km2, data = paper2, risk.table = F, conf.int = F, fun = "event") + labs(title = "Does more dominant mean better at paper test?")

#this is pretty close, I should run a log rank test to determine if there is a statistical difference in these curves 

survdiff(Surv(paper2$time,paper2$status) ~ paper2$dom_bin)
#dominance is not statistically  

#age has the biggest the 
```


```{r}
#urban or rural: 
paper2.km3 = survfit(Surv(paper2$time,paper2$status) ~ paper2$habitat)

ggsurvplot(fit = paper2.km3, data = paper2, risk.table = F, conf.int = F, fun = "event") + labs(title = "Rural vs. Urban Birds")

#rural birds are better at solving at the beginning, but by the end they have the same likelihood of solving problem. 


#urban or rural, stratify by age: 
paper2.km3 = survfit(Surv(paper2$time,paper2$status) ~ paper2$habitat + strata())

ggsurvplot(fit = lever2.km4, data = lever2, risk.table = F, conf.int = F, fun = "event") + labs(title = "Juvenile vs. Adult Birds")

paper2$indiv
lever2$indiv

```


##DATASET 3: Persistence & Repeatability 

capturedate: date (yyyymmdd) that each bird was captured
site: code of each field site.
indiv: individual band number identification
age: age class – adult or juvenile.
sex: female or male.
habitat: rural (urban score < 0) or urban (urban score > 0) habitat type.
urbanscore: urbanization score generated by PCA analysis used to infer degree of urbanization at each site.
explscore: exploration score generated by PCA analysis.
domscore: dominance score based on interactions between birds at RFID feeders.
lpsolve: whether the lever-pulling task was solved (Y) or not (N).
lplatency: latency to solve or become censored in the lever-pulling trials.
lpstatus: censoring status of latency to solve the lever-pulling task used for cox regression (0 = censored, 1 = uncensored).
lpcontacts: total number of contacts made with the lever-pulling task until the bird solved the task or the observation became censored.
prsolve: whether the paper-ripping task was solved (Y) or not (N).
prlatency: latency to solve or become censored in the paper-ripping trials.
prstatus: censoring status of latency to solve the paper-ripping task used for cox regression (0 = censored, 1 = uncensored).
prcontacts: total number of contacts made with the paper-ripping task until the bird solved the task or the observation became censored


```{r}
head(pr)
```



EDA FINDINGS: 

- There are only 65 birds in this trial 
- The covariates/characteristics here are domscore, urbanscore, explscore
- contacts. 
